<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>PWM </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="PWM ">
    <meta name="generator" content="docfx 2.19.2.0">
    
    <link rel="shortcut icon" href="../../images/favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    <meta property="docfx:rel" content="../../">
    <meta property="docfx:newtab" content="true">
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../images/logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="pwm">PWM</h1>

<p>Pulse Width Modulation (PWM) is a very import feature found in most microcontrollers. PWM is a pulse that is repeated and generated by the internal hardware. The ratio of the pulse width and its frequency is called duty cycle. Through software, you can control the pulse&#39;s frequency and duty cycle.</p>
<div class="TIP"><h5>Tip</h5><p>we use usually use GetDefault() for most peripherals. For example, there is only one GPIO controller on most systems. This is not the case with PWM. Never use the Default controller and  always&gt; select the proper channel on the correspondent controller.</p>
</div>
<div class="TIP"><h5>Tip</h5><p>PWM2.3 is channel 3 on controller 2</p>
</div>
<h2 id="energy-level">Energy Level</h2>
<p>PWM is perfect for dimming an LED or slowing down a motor. This is done by turning power on and off, at a high speed. When power is on half the time and off half the time, only half the energy is transferred, to the LED or a motor.</p>
<p>This demo will fade the LED in and out</p>
<pre><code class="lang-csharp">using System;
using System.Diagnostics;
using System.Threading;
using GHIElectronics.TinyCLR.Devices.Pwm;
using GHIElectronics.TinyCLR.Pins;

class Program
{
    static void Main()
    {
        PwmController Controller4 = PwmController.FromId(FEZ.PwmPin.Controller4.Id);
        PwmPin led = Controller4.OpenPin(FEZ.PwmPin.Controller4.Led1);
        Controller4.SetDesiredFrequency(10000);
        double duty = 0.5, speed = 0.01;
              led.Start();
        while (true)
        {

            led.SetActiveDutyCyclePercentage(duty);
            duty += speed;
            if (duty &lt;= 0 || duty &gt;= 1)
                duty *= -1;//invert dirrection
            Thread.Sleep(10);// always give the system time to think!
        }
    }

}   
</code></pre><h2 id="musical-tones">Musical Tones</h2>
<p>Music notes have specific frequencies; C for example is about 261Hz. Plugging these numbers into an array and knowing the length of each tone is all that is needed to play some simple music. When playing notes by changing the frequency, keep thee duty cycle set to 0.5.</p>
<pre><code class="lang-csharp">using System;
using System.Diagnostics;
using System.Threading;
using GHIElectronics.TinyCLR.Devices.Pwm;
using GHIElectronics.TinyCLR.Pins;

class Program
{
    const int NOTE_C = 261;
    const int NOTE_D = 294;
    const int NOTE_E = 330;
    const int NOTE_F = 349;
    const int NOTE_G = 392;

    const int WHOLE_DURATION = 1000;
    const int EIGHTH = WHOLE_DURATION / 8;
    const int QUARTER = WHOLE_DURATION / 4;
    const int QUARTERDOT = WHOLE_DURATION / 3;
    const int HALF = WHOLE_DURATION / 2;
    const int WHOLE = WHOLE_DURATION;

    //make sure the two below arrays match in length. each duration element corresponds to
    //one note element.
    static int[] note = { NOTE_E, NOTE_E, NOTE_F, NOTE_G, NOTE_G, NOTE_F, NOTE_E,
                          NOTE_D, NOTE_C, NOTE_C, NOTE_D, NOTE_E, NOTE_E, NOTE_D,
                          NOTE_D, NOTE_E, NOTE_E, NOTE_F, NOTE_G, NOTE_G, NOTE_F,
                          NOTE_E, NOTE_D, NOTE_C, NOTE_C, NOTE_D, NOTE_E, NOTE_D,
                          NOTE_C, NOTE_C};

    static int[] duration = { QUARTER, QUARTER, QUARTER, QUARTER, QUARTER, QUARTER,    QUARTER,
                              QUARTER, QUARTER, QUARTER, QUARTER, QUARTER, QUARTERDOT, EIGHTH,
                              HALF,    QUARTER, QUARTER, QUARTER, QUARTER, QUARTER,    QUARTER,
                              QUARTER, QUARTER, QUARTER, QUARTER, QUARTER, QUARTER,    QUARTERDOT,
                              EIGHTH,  WHOLE};
    static void Main()
    {
        PwmController Controller1 = PwmController.FromId(FEZ.PwmPin.Controller1.Id);
        PwmPin tones = Controller1.OpenPin(FEZ.PwmPin.Controller1.D0);
        tones.SetActiveDutyCyclePercentage(0.5);
        tones.Start();
        while (true)
        {
            for (int i = 0; i &lt; note.Length; i++)
            {
                Controller1.SetDesiredFrequency( note[i]);
                Thread.Sleep(duration[i]);
            }
            Thread.Sleep(100);
        }
    }

}   
</code></pre><h2 id="servo-motors">Servo Motors</h2>
<p>Servo motors are controlled by a repeated pulse. The pulse is generated every 20ms. This pulse will have a width between 1ms and 2ms, for min and max. Positional servos will go to a psecific derction based on the pulse width. Full rotational servos can be controlled, speed and direction, through this pulse, where 1.5ms pulse will stop, 1ms is full speed and 1ms is reverse full speed. </p>
<div class="TIP"><h5>Tip</h5><p>most servos will have a 1.25ms min and 1.75max.</p>
</div>
<pre><code class="lang-csharp">using System;
using System.Diagnostics;
using System.Threading;
using GHIElectronics.TinyCLR.Devices.Pwm;
using GHIElectronics.TinyCLR.Pins;

class Program
{
    static void Main()
    {
        PwmController Controller1 = PwmController.FromId(FEZ.PwmPin.Controller1.Id);
        PwmPin servo = Controller1.OpenPin(FEZ.PwmPin.Controller1.D0);

        Controller1.SetDesiredFrequency(1 / 0.020);//a pulse every 20ms
        double maxPulseLength = 1.75;
        double minPulseLength = 1.25;
        double position = 90;
        double speed = 0.5;
        servo.Start();
        while (true)
        {
            double duty = ((position / 180.0) * (maxPulseLength / 20 - minPulseLength / 20)) + minPulseLength / 20;
            servo.SetActiveDutyCyclePercentage(duty);
            position += speed;
            if (position &lt;= 0 || position &gt;= 180)
                duty *= -1;//reverse dirrection

            Thread.Sleep(10);// always give the system time to think!
        }
    }

}   
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/ghi-electronics/Docs/blob/dev/tinyclr/tutorials/pwm.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Copyright © 2017 GHI Electronics, LLC<br>Generated by <strong>DocFX</strong></span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
